<!doctype html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>פורצות דרך | חיבור לשותפות</title>

<style>
:root{
  --bg:#0f172a;
  --card:rgba(255,255,255,.08);
  --border:rgba(255,255,255,.18);
  --text:#f8fafc;
  --muted:#c7d2fe;
  --accent:#ec4899;
  --accent2:#6366f1;
  --radius:18px;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,"Segoe UI",Arial;background:linear-gradient(145deg,#020617,#0f172a);color:var(--text)}

.container{max-width:760px;margin:auto;padding:24px;padding-top:92px}

/* פס עליון למדריכה */
#instructorBar{
  position:fixed;
  top:0;left:0;right:0;
  background:rgba(2,6,23,.92);
  border-bottom:1px solid var(--border);
  z-index:100;
  backdrop-filter: blur(10px);
}
#instructorBar .inner{
  max-width:760px;
  margin:auto;
  padding:10px 24px;
  display:flex;
  gap:10px;
  align-items:center;
}
#instructorBar label{margin:0;font-size:12px;color:var(--muted)}
#instructorBar input{
  padding:8px 10px;
  font-size:14px;
  width:120px;
  border-radius:12px;
  border:1px solid var(--border);
  background:rgba(0,0,0,.25);
  color:var(--text);
  outline:none;
}
#instructorBar button{
  margin:0;
  padding:8px 14px;
  font-size:14px;
  width:auto;
  border:none;
  border-radius:12px;
  font-weight:800;
  cursor:pointer;
  color:white;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
}
#instructorBar .status{
  margin-right:auto;
  font-size:12px;
  color:rgba(248,250,252,.8);
}

.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:26px;margin-bottom:18px}

h1{margin:0 0 12px;font-size:24px;color:var(--accent)}
h2{margin:0 0 10px;font-size:18px}
p{color:var(--muted);line-height:1.75;margin:0 0 12px}

button.primary{width:100%;margin-top:16px;padding:14px;border:none;border-radius:14px;font-weight:800;cursor:pointer;color:white;background:linear-gradient(135deg,var(--accent),var(--accent2))}

/* כפתור התחלה קטן - לפי אורך המילה */
button.start-compact{
  width:auto;
  display:inline-block;
  padding:10px 18px;
  border-radius:999px;
  font-size:16px;
  font-weight:900;
  margin:16px auto 0;
}

/* אנימציית הופעה רכה לכפתור התחלה */
@keyframes softAppear{
  from{opacity:0;transform:translateY(8px) scale(.98)}
  to{opacity:1;transform:translateY(0) scale(1)}
}
.start-animate{animation:softAppear .6s ease-out both;}

button.secondary{width:100%;margin-top:12px;padding:14px;border-radius:14px;font-weight:800;cursor:pointer;color:var(--text);background:transparent;border:1px solid var(--border)}

.hidden{display:none}
.quote{margin:16px 0;padding:14px;border-radius:14px;background:rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.18);font-weight:650;text-align:center}

.intro-note{margin:14px 0 6px;padding:14px 14px 12px;border-radius:14px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.14)}
.intro-note p{margin:0 0 10px;color:rgba(248,250,252,.92)}
.intro-note ul{margin:0;padding:0 18px 0 0;color:var(--muted);line-height:1.8}
.intro-note li{margin:6px 0}

label{display:flex;align-items:center;gap:8px;margin-top:14px;color:#f1f5ff;font-weight:700}
label::before{content:"❓";font-size:18px;opacity:.9}
input{width:100%;padding:12px;margin-top:6px;border-radius:12px;border:1px solid var(--border);background:rgba(0,0,0,.35);color:#ffffff;font-size:15px}

/* קבוצות לחיצה במקום select */
.choice-group{display:grid;grid-template-columns:1fr;gap:10px;margin-top:8px}
.choice{padding:12px 14px;border-radius:14px;border:1px solid var(--border);background:rgba(0,0,0,.25);cursor:pointer;font-weight:400;transition:.2s}
.choice:hover{background:rgba(255,255,255,.08)}
.choice.active{background:linear-gradient(135deg,rgba(236,72,153,.35),rgba(99,102,241,.35));border-color:var(--accent)}
@media (min-width:520px){.choice-group{grid-template-columns:1fr 1fr}}

.small-note{font-size:13px;color:rgba(199,210,254,.9);margin-top:10px}

/* נא להמתין - ורוד זוהר */
.wait-text{
  text-align:center;
  font-size:20px;
  font-weight:900;
  color:#ff3ea5;
  text-shadow:0 0 8px rgba(255,62,165,.8),0 0 18px rgba(255,62,165,.6);
  margin-top:18px;
}

/* מסך חשיבה */
.thinking{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px}
@keyframes blink{0%,100%{opacity:.3}50%{opacity:1}}
.thinking-dots span{font-size:32px;color:#ff3ea5;animation:blink 1.2s infinite}
.thinking-dots span:nth-child(2){animation-delay:.2s}
.thinking-dots span:nth-child(3){animation-delay:.4s}
</style>
</head>

<body>
<!-- פס מדריכה עליון (מוסתר כברירת מחדל) -->
<div id="instructorBar" class="hidden">
  <div class="inner">
    <label for="instructorCode">קוד מדריכה</label>
    <input id="instructorCode" type="password" inputmode="numeric" placeholder="••••" autocomplete="one-time-code">

    <label for="expectedCount" style="margin-right:8px">מס' משתתפות</label>
    <input id="expectedCount" inputmode="numeric" placeholder="18" style="width:90px">

    <button id="activateBtn" type="button">התחל פעילות</button>
    <div class="status" id="barStatus">הפעילות עדיין לא הופעלה</div>
  </div>
</div>

<div class="container">

  <!-- כפתור פתיחת אזור מדריכה -->
  <button id="openInstructor" class="secondary" type="button" style="margin-bottom:12px">כניסת מדריכה</button>

  <!-- מסך פתיחה / המתנה -->
  <div class="card" id="introScreen">
    <h1>בחירת שותפה לתהליך</h1>
    <div class="intro-note">
      <p><strong>הפעילות הזו אינה מבחן</strong> - ואין בה תשובות נכונות או לא נכונות.</p>
      <p>המטרה היא ליצור <strong>שותפות טובה</strong> לעבודה משותפת בתהליך התיכון ההנדסי.</p>
      <ul>
        <li><strong>היכרות</strong> - להבין מי את ואיך נוח לך לעבוד</li>
        <li><strong>אמון</strong> - להתחיל יחד בתחושה טובה ובטוחה</li>
        <li><strong>דיוק</strong> - לבחור שותפה שתעזור לכן להתקדם באמת</li>
      </ul>
    </div>

    <div class="quote">פורצת דרך מצליחה כשהיא צועדת קדימה עם נשים מצליחות כמוה.</div>

    <p class="wait-text" id="waitText"><strong>נא להמתין</strong></p>

    <div style="text-align:center">
      <button id="startBtn" class="primary start-compact hidden" type="button">מתחילות</button>
    </div>
  </div>

  <!-- שלב 1 -->
  <div class="card hidden" id="step1">
    <h2>לפני שמתחילות</h2>
    <label>שם פרטי / כינוי (כדי שתוכלי לזהות את עצמך במסך החיבורים)</label>
    <input id="displayName" placeholder="לדוגמה: נועה" maxlength="24">

    <h2 style="margin-top:18px">תחומי עניין</h2>
    <label>מה התחום המרכזי שבחרת?</label>
    <div class="choice-group" data-field="mainDomain">
      <div class="choice">הייטק וליבה</div>
      <div class="choice">אדם וטכנולוגיה</div>
      <div class="choice">סביבה וקיימות</div>
      <div class="choice">עתיד ויזמות</div>
      <div class="choice">חברה ודיגיטל</div>
    </div>

    <label>האם יש תחום נוסף שמעניין אותך?</label>
    <div class="choice-group" data-field="secondDomain">
      <div class="choice">הייטק וליבה</div>
      <div class="choice">אדם וטכנולוגיה</div>
      <div class="choice">סביבה וקיימות</div>
      <div class="choice">עתיד ויזמות</div>
      <div class="choice">חברה ודיגיטל</div>
      <div class="choice">אין תחום נוסף שמעניין אותי כרגע</div>
    </div>

    <button class="primary" type="button" onclick="next(2)">המשך</button>
  </div>

  <!-- שלב 2 -->
  <div class="card hidden" id="step2">
    <h2>איך את פועלת?</h2>
    <label>כשיש משימה חדשה ולא ברורה:</label>
    <div class="choice-group" data-field="workStyle">
      <div class="choice">מתחילה להתנסות ולומדת תוך כדי</div>
      <div class="choice">עוצרת להבין ולתכנן</div>
    </div>

    <label>בעבודה בזוג:</label>
    <div class="choice-group" data-field="teamStyle">
      <div class="choice">חושבת בקול ומשתפת</div>
      <div class="choice">עובדת בשקט ואז מציגה</div>
    </div>

    <button class="primary" type="button" onclick="next(3)">המשך</button>
  </div>

  <!-- שלב 3 -->
  <div class="card hidden" id="step3">
    <h2>קצת מהחיים שלך</h2>

    <label>איזה תוכן מושך אותך באמת ביום-יום?</label>
    <div class="choice-group" data-field="lifeInterest">
      <div class="choice">טכנולוגיה ואפליקציות</div>
      <div class="choice">אנשים והשפעה חברתית</div>
      <div class="choice">סביבה וקיימות</div>
      <div class="choice">רעיונות ועתיד</div>
    </div>

    <label>מתי את מרגישה שאת מביאה ערך לקבוצה?</label>
    <div class="choice-group" data-field="valuePlace">
      <div class="choice">כשאני מביאה רעיון חדש</div>
      <div class="choice">כשאני עוזרת להבין</div>
      <div class="choice">כשאני מחברת אנשים</div>
      <div class="choice">כשאני משנה מצב קיים</div>
    </div>

    <label>כשיש אי-הסכמה בעבודה משותפת, מה את נוטה לעשות?</label>
    <div class="choice-group" data-field="conflictStyle">
      <div class="choice">עוצרת ומנסה להבין את הצד השני</div>
      <div class="choice">מציגה עמדה ברורה ומנסה לשכנע</div>
    </div>

    <label>מה עוזר לך להתמיד בפרויקט לאורך זמן?</label>
    <div class="choice-group" data-field="motivationSource">
      <div class="choice">תחושת משמעות והשפעה</div>
      <div class="choice">אתגר ופתרון בעיות</div>
    </div>

    <button class="primary" type="button" onclick="finish()">סיימתי - מוכנה לשותפות</button>
  </div>

  <!-- מסך המתנה לאחר מילוי -->
  <div class="card hidden" id="waiting">
    <h1>מחכות יחד</h1>
    <p>מעולה - הבחירות שלך נשמרו.</p>
    <p>כשהמדריכה תייצר את החיבורים, תראי כאן את תוצאת השותפות.</p>
  </div>

  <!-- מסך חשיבה לפני חיבורים -->
  <div class="card hidden" id="thinking">
    <div class="thinking">
      <h1>חושבות יחד</h1>
      <div class="thinking-dots"><span>•</span><span>•</span><span>•</span></div>
      <p class="small-note">מחפשות את השותפות המדויקת ביותר…</p>
    </div>
  </div>

  <!-- מסך חיבורים -->
  <div class="card hidden" id="pairing">
    <h1>מסך החיבורים</h1>
    <p>שותפות טובה נבנית משילוב של <strong>תחומי עניין משותפים</strong> ודרך עבודה משלימה.</p>
    <p class="small-note">זוהי מיומנות מרכזית בעולם ההייטק: לדעת לעבוד יחד, לחלוק אחריות, ולנוע קדימה כצוות.</p>
    <div id="pairingResult"></div>
    <button class="secondary" type="button" onclick="goHome()">חזרה לדף הבית</button>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  doc,
  setDoc,
  getDoc,
  onSnapshot,
  collection,
  getDocs,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCFSq5b-HgkTxFNhBJIBdOe2ian5TZvMPE",
  authDomain: "portzot-derech.firebaseapp.com",
  projectId: "portzot-derech"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// מסמכים/קולקציות (מותאם לרולס: instructors / sessions / responses)
const SESSION_ID = "active";
const sessionRef = doc(db, "sessions", SESSION_ID);
const responsesRef = collection(db, "responses");

const SESSION_DURATION_MS = 20 * 60 * 1000; // 20 דקות
const DAY_MS = 24 * 60 * 60 * 1000;

// קאש קטן בדפדפן למניעת מילוי כפול מאותו מכשיר
const DEVICE_ID_KEY = "pd_pairing_device_id";
const deviceId = localStorage.getItem(DEVICE_ID_KEY) || crypto.randomUUID();
localStorage.setItem(DEVICE_ID_KEY, deviceId);

// DOM
const openInstructorBtn = document.getElementById('openInstructor');
const instructorBar = document.getElementById('instructorBar');
const startBtn = document.getElementById('startBtn');
const waitText = document.getElementById('waitText');

const activateBtn = document.getElementById('activateBtn');
const expectedCountInput = document.getElementById('expectedCount');
const instructorCode = document.getElementById('instructorCode');
const barStatus = document.getElementById('barStatus');

const displayName = document.getElementById('displayName');
const pairingResult = document.getElementById('pairingResult');

// ערכים נבחרים מקבוצות לחיצה
const selections = {};
document.querySelectorAll('.choice-group').forEach(group => {
  const field = group.dataset.field;
  group.querySelectorAll('.choice').forEach(ch => {
    ch.addEventListener('click', () => {
      group.querySelectorAll('.choice').forEach(c => c.classList.remove('active'));
      ch.classList.add('active');
      selections[field] = ch.textContent.trim();
    });
  });
});

function showOnly(id){
  document.querySelectorAll('.container .card').forEach(c => c.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

function setStartEnabled(enabled){
  if(enabled){
    startBtn.classList.remove('hidden');
    startBtn.classList.remove('start-animate');
    requestAnimationFrame(() => startBtn.classList.add('start-animate'));
    waitText?.classList.add('hidden');
  } else {
    startBtn.classList.add('hidden');
    waitText?.classList.remove('hidden');
  }
}

function resetToWaiting(){
  setStartEnabled(false);
  showOnly('introScreen');
}

// מצב התחלתי
resetToWaiting();

// מצב סשן
let currentSession = null;
let sessionEndsAt = 0;
let pairingShown = false;

async function countValidResponses(){
  const snap = await getDocs(responsesRef);
  const now = Date.now();
  let c = 0;
  snap.docs.forEach(d => {
    const x = d.data();
    if(x.sessionId === SESSION_ID && typeof x.createdAt === 'number' && (now - x.createdAt) <= DAY_MS){
      c++;
    }
  });
  return c;
}

function isActiveFromData(data){
  if(!data?.started || typeof data.startTime !== 'number') return false;
  return Date.now() < (data.startTime + SESSION_DURATION_MS);
}

// מאזין לסשן
onSnapshot(sessionRef, async (snap) => {
  pairingShown = false; // אם המדריכה מפעילה מחדש - נאפשר להציג שוב

  if(!snap.exists()){
    currentSession = null;
    barStatus.textContent = "הפעילות עדיין לא הופעלה";
    resetToWaiting();
    return;
  }

  const data = snap.data();
  currentSession = data;

  if(isActiveFromData(data)){
    sessionEndsAt = data.startTime + SESSION_DURATION_MS;

    const now = Date.now();
    const answersCount = await countValidResponses();
    const minsLeft = Math.max(0, Math.ceil((sessionEndsAt - now) / 60000));
    const expected = Number(data.expectedCount || 0);
    const progress = expected ? ` · ${answersCount}/${expected} תשובות` : '';

    barStatus.textContent = `פעיל עכשיו · נשארו בערך ${minsLeft} דק'${progress}`;
    setStartEnabled(true);

    if(data.pairingReady){
      await showPairing();
    }
    return;
  }

  // לא פעיל (נגמר הזמן / לא התחיל באמת)
  barStatus.textContent = "הפעילות עדיין לא הופעלה";
  resetToWaiting();
});

// פתיחת אזור מדריכה
openInstructorBtn.addEventListener('click', () => {
  instructorBar.classList.remove('hidden');
  openInstructorBtn.classList.add('hidden');
  // התמקדות נעימה על שדה קוד (מוסתר תמיד)
  setTimeout(() => instructorCode?.focus(), 50);
});

// כפתור המדריכה (פרודקשן)
// לחיצה ראשונה: הפעלה
// לחיצה שנייה (אחרי שכולן סיימו): יצירת חיבורים
activateBtn.addEventListener('click', async () => {
  const sessionSnap = await getDoc(sessionRef);
  const sessionData = sessionSnap.exists() ? sessionSnap.data() : null;

  const active = isActiveFromData(sessionData);

  if(!active){
    const code = (instructorCode.value || '').trim();
    if(!code){
      barStatus.textContent = "נא להזין קוד מדריכה";
      return;
    }

    // בדיקה שקוד קיים ב-instructors
    const instructorRef = doc(db, 'instructors', code);
    const instSnap = await getDoc(instructorRef);
    if(!instSnap.exists() || instSnap.data()?.active !== true){
      barStatus.textContent = "קוד לא תקין";
      return;
    }

    const startTime = Date.now();
    await setDoc(sessionRef, {
      started: true,
      startTime,
      pairingReady: false,
      instructorCode: code,
      expectedCount: Number(expectedCountInput.value || 0),
      expiresAt: new Date(startTime + DAY_MS),
      updatedAt: serverTimestamp()
    }, { merge: true });

    // מסתירים את שדה הקוד אחרי ההפעלה (הקוד מוסתר תמיד גם לפני)
    instructorCode.classList.add('hidden');

    barStatus.textContent = "הפעילות הופעלה";
    setStartEnabled(true);
    return;
  }

  // לחיצה שנייה: יצירת חיבורים
  const expected = Number(sessionData?.expectedCount || 0);
  const answersCount = await countValidResponses();

  if(expected && answersCount !== expected){
    barStatus.textContent = `ממתינה: ${answersCount}/${expected} תשובות`;
    return;
  }

  await setDoc(sessionRef, { pairingReady: true, updatedAt: serverTimestamp() }, { merge:true });
  barStatus.textContent = "החיבורים נוצרו";
});

// ניווט בין שלבים - כל השאלות חובה ואין חזרה
window.next = (n) => {
  if(n === 2){
    const required = ['mainDomain','secondDomain'];
    if(required.some(k => !selections[k])){
      alert('נא לענות על כל השאלות לפני המשך');
      return;
    }
  }
  if(n === 3){
    const required = ['workStyle','teamStyle'];
    if(required.some(k => !selections[k])){
      alert('נא לענות על כל השאלות לפני המשך');
      return;
    }
  }

  if(n === 2) return showOnly('step2');
  if(n === 3) return showOnly('step3');
};

// כניסה לשאלון (רק כשהמדריכה הפעילה)
startBtn.addEventListener('click', () => {
  if(sessionEndsAt && Date.now() > sessionEndsAt){
    resetToWaiting();
    return;
  }
  showOnly('step1');
});

// שמירת תשובות
window.finish = async () => {
  if(!displayName.value.trim()){
    alert('כתבי שם פרטי/כינוי כדי שתוכלי לזהות את עצמך במסך החיבורים.');
    return;
  }

  const required = [
    'mainDomain','secondDomain','workStyle','teamStyle',
    'lifeInterest','valuePlace','conflictStyle','motivationSource'
  ];
  const missing = required.filter(k => !selections[k]);
  if(missing.length){
    alert('נא לענות על כל השאלות לפני סיום.');
    return;
  }

  if(sessionEndsAt && Date.now() > sessionEndsAt){
    resetToWaiting();
    return;
  }

  const payload = {
    sessionId: SESSION_ID,
    deviceId,
    displayName: displayName.value.trim(),
    mainDomain: selections.mainDomain,
    secondDomain: selections.secondDomain,
    workStyle: selections.workStyle,
    teamStyle: selections.teamStyle,
    lifeInterest: selections.lifeInterest,
    valuePlace: selections.valuePlace,
    conflictStyle: selections.conflictStyle,
    motivationSource: selections.motivationSource,
    createdAt: Date.now(),
    expiresAt: new Date(Date.now() + DAY_MS)
  };

  await setDoc(doc(responsesRef, crypto.randomUUID()), payload);
  showOnly('waiting');
};

// אלגוריתם חיבורים
function score(a, b){
  let s = 0;

  // 1) תחומי עניין משותפים (חזק)
  if(a.mainDomain === b.mainDomain) s += 10;
  if(a.mainDomain === b.secondDomain) s += 6;
  if(b.mainDomain === a.secondDomain) s += 6;

  // 2) השלמה בסגנון עבודה (חזק)
  if(a.workStyle !== b.workStyle) s += 5;
  if(a.teamStyle !== b.teamStyle) s += 4;

  // 3) חיים/כיוון (בינוני)
  if(a.lifeInterest === b.lifeInterest) s += 2;
  if(a.valuePlace === b.valuePlace) s += 2;

  // 4) התנהלות בקונפליקט ומוטיבציה (משלים)
  if(a.conflictStyle !== b.conflictStyle) s += 3;
  if(a.motivationSource === b.motivationSource) s += 2;

  // שובר שוויון דטרמיניסטי קטן
  const key = (a.displayName + '|' + b.displayName).split('').reduce((acc,ch)=>acc+ch.charCodeAt(0),0);
  s += (key % 7) * 0.01;

  return s;
}

function pickBestPairs(list){
  let students = [...list];
  let pairs = [];

  while(students.length > 1){
    let best = {i:-1,j:-1,sc:-Infinity};
    for(let i=0;i<students.length;i++){
      for(let j=i+1;j<students.length;j++){
        const sc = score(students[i], students[j]);
        if(sc > best.sc){
          best = {i,j,sc};
        }
      }
    }

    const a = students[best.i];
    const b = students[best.j];
    pairs.push({a,b,sc:best.sc});
    students = students.filter((_,idx)=>idx !== best.i && idx !== best.j);
  }

  let trio = null;
  if(students.length === 1 && pairs.length){
    const lone = students[0];
    let bestIdx = 0;
    let bestTrioScore = -Infinity;
    for(let k=0;k<pairs.length;k++){
      const t = score(lone, pairs[k].a) + score(lone, pairs[k].b);
      if(t > bestTrioScore){
        bestTrioScore = t;
        bestIdx = k;
      }
    }
    trio = { lone, withPairIndex: bestIdx };
  }

  return {pairs, trio};
}

async function showPairing(){
  if(pairingShown) return;
  pairingShown = true;

  showOnly('thinking');
  await new Promise(r=>setTimeout(r,5000));

  const snap = await getDocs(responsesRef);
  const now = Date.now();
  const all = snap.docs.map(d => d.data());

  const students = all
    .filter(x => x.sessionId === SESSION_ID)
    .filter(x => typeof x.createdAt === 'number' && (now - x.createdAt) <= DAY_MS);

  if(students.length < 2){
    resetToWaiting();
    return;
  }

  const {pairs, trio} = pickBestPairs(students);

  pairingResult.innerHTML = "";

  pairs.forEach((p) => {
    const div = document.createElement('div');
    div.className = 'quote';
    div.innerHTML = `
      <strong>${p.a.displayName}</strong> ↔ <strong>${p.b.displayName}</strong><br>
      <span style="opacity:.9">תחום: ${p.a.mainDomain} · ${p.b.mainDomain}</span><br>
      <span style="opacity:.85">נבחר לפי תחומי עניין משותפים והשלמה בסגנון עבודה</span>
    `;
    pairingResult.appendChild(div);
  });

  if(trio && pairs[trio.withPairIndex]){
    const tDiv = document.createElement('div');
    tDiv.className = 'quote';
    const base = pairs[trio.withPairIndex];
    tDiv.innerHTML = `
      <strong>שלשה</strong><br>
      ${base.a.displayName} · ${base.b.displayName} · ${trio.lone.displayName}<br>
      <span style="opacity:.85">בכיתה עם מספר אי-זוגי - נוצרת שלשה אחת כדי לשמור על שותפות לכל משתתפת.</span>
    `;
    pairingResult.appendChild(tDiv);
  }

  showOnly('pairing');
}

// בדיקות עצמאיות (רק אם מוסיפים ?test=1 לכתובת)
function assert(name, cond){
  if(!cond){
    console.error('TEST FAIL:', name);
  } else {
    console.log('TEST OK:', name);
  }
}

if(new URLSearchParams(location.search).get('test') === '1'){
  // 1) setStartEnabled לא זורק שגיאה
  try{ setStartEnabled(false); setStartEnabled(true); assert('setStartEnabled runs', true); }
  catch(e){ assert('setStartEnabled runs', false); }

  // 2) score סימטרי
  const A = {displayName:'א', mainDomain:'הייטק וליבה', secondDomain:'עתיד ויזמות', workStyle:'x', teamStyle:'y', lifeInterest:'t', valuePlace:'v', conflictStyle:'c', motivationSource:'m'};
  const B = {displayName:'ב', mainDomain:'הייטק וליבה', secondDomain:'אדם וטכנולוגיה', workStyle:'z', teamStyle:'w', lifeInterest:'t', valuePlace:'q', conflictStyle:'d', motivationSource:'m'};
  assert('score is symmetric-ish', Math.abs(score(A,B) - score(B,A)) < 0.2);

  // 3) pickBestPairs מחזיר זוג אחד
  const res = pickBestPairs([A,B]);
  assert('pickBestPairs creates one pair', res.pairs.length === 1);
}

// ניווט דף בית (התאימי את הכתובת אצלך)
window.goHome = () => {
  window.location.href = "../index.html";
};
</script>
</body>
</html>

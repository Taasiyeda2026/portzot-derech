<!doctype html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>פורצות דרך | חיבור לשותפות</title>

<style>
:root{
  --bg:#0f172a;
  --card:rgba(255,255,255,.08);
  --border:rgba(255,255,255,.18);
  --text:#f8fafc;
  --muted:#c7d2fe;
  --accent:#ec4899;
  --accent2:#6366f1;
  --radius:18px;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,"Segoe UI",Arial;background:linear-gradient(145deg,#020617,#0f172a);color:var(--text)}
.container{max-width:760px;margin:auto;padding:24px}
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:26px;margin-bottom:22px}

h1{margin:0 0 12px;font-size:24px;color:var(--accent)}
h2{margin:0 0 10px;font-size:18px}
p{color:var(--muted);line-height:1.7;margin:0 0 14px}

button{width:100%;margin-top:18px;padding:14px;border:none;border-radius:14px;font-weight:700;cursor:pointer;color:white;background:linear-gradient(135deg,var(--accent),var(--accent2))}
button.secondary{background:transparent;border:1px solid var(--border)}

.hidden{display:none}
.quote{margin:18px 0;padding:16px;border-radius:14px;background:rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.18);font-weight:600;text-align:center}

label{display:block;margin-top:16px;color:var(--muted)}
input,select{width:100%;padding:12px;margin-top:6px;border-radius:12px;border:1px solid var(--border);background:rgba(0,0,0,.25);color:var(--text)}
</style>
</head>

<body>
<div class="container">

<!-- מסך פתיחה / המתנה -->
<div class="card" id="introScreen">
  <h1>בחירת שותפה לתהליך</h1>
  <p>הפעילות הזו אינה מבחן ואין בה תשובות נכונות או לא נכונות.</p>
  <p>המטרה היא ליצור שותפות טובה לעבודה משותפת בתהליך ההנדסי.</p>
  <div class="quote">פורצת דרך מצליחה כשהיא צועדת קדימה עם נשים מצליחות כמוה.</div>
  <p><strong>הפעילות תיפתח כאשר המדריכה תפעיל אותה.</strong></p>
  <button id="startBtn" class="hidden">מתחילות</button>
</div>

<!-- מסכי שאלון -->
<div class="card hidden" id="step1">
  <h2>תחומי עניין</h2>
  <label>מה התחום המרכזי שבחרת?</label>
  <select id="mainDomain">
    <option value="">בחרי</option>
    <option>הייטק וליבה</option>
    <option>אדם וטכנולוגיה</option>
    <option>סביבה וקיימות</option>
    <option>עתיד ויזמות</option>
    <option>חברה ודיגיטל</option>
  </select>

  <label>האם יש תחום נוסף שמעניין אותך?</label>
  <select id="secondDomain">
    <option value="">בחרי</option>
    <option>הייטק וליבה</option>
    <option>אדם וטכנולוגיה</option>
    <option>סביבה וקיימות</option>
    <option>עתיד ויזמות</option>
    <option>חברה ודיגיטל</option>
    <option>אין תחום נוסף שמעניין אותי כרגע</option>
  </select>
  <button onclick="next(2)">המשך</button>
</div>

<div class="card hidden" id="step2">
  <h2>איך את פועלת?</h2>
  <label>כשיש משימה חדשה ולא ברורה:</label>
  <select id="workStyle">
    <option value="">בחרי</option>
    <option>מתחילה להתנסות ולומדת תוך כדי</option>
    <option>עוצרת להבין ולתכנן</option>
  </select>

  <label>בעבודה בזוג:</label>
  <select id="teamStyle">
    <option value="">בחרי</option>
    <option>חושבת בקול ומשתפת</option>
    <option>עובדת בשקט ואז מציגה</option>
  </select>
  <button onclick="next(3)">המשך</button>
</div>

<div class="card hidden" id="step3">
  <h2>קצת מהחיים שלך</h2>
  <label>איזה תוכן מושך אותך באמת?</label>
  <select id="lifeInterest">
    <option value="">בחרי</option>
    <option>טכנולוגיה ואפליקציות</option>
    <option>אנשים והשפעה חברתית</option>
    <option>סביבה וקיימות</option>
    <option>רעיונות ועתיד</option>
  </select>

  <label>מתי את מרגישה שאת מביאה ערך?</label>
  <select id="valuePlace">
    <option value="">בחרי</option>
    <option>כשאני מביאה רעיון חדש</option>
    <option>כשאני עוזרת להבין</option>
    <option>כשאני מחברת אנשים</option>
    <option>כשאני משנה מצב קיים</option>
  </select>
  <button onclick="finish()">סיימתי – מוכנה לשותפות</button>
</div>

<!-- מסך המתנה -->
<div class="card hidden" id="waiting">
  <h1>מחכות יחד</h1>
  <p>הבחירות שלך נשמרו.</p>
  <p>כשהחיבורים ייווצרו – תראי כאן את השותפה שלך.</p>
</div>

<!-- מסך חיבורים -->
<div class="card hidden" id="pairing">
  <h1>השותפות שלך</h1>
  <p>שותפות טובה נבנית משילוב של תחומי עניין ודרך עבודה.</p>
  <div id="pairingResult"></div>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc, onSnapshot, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCFSq5b-HgkTxFNhBJIBdOe2ian5TZvMPE",
  authDomain: "portzot-derech.firebaseapp.com",
  projectId: "portzot-derech"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const sessionRef = doc(db, "session", "active");
const responsesRef = collection(db, "responses");

const SESSION_DURATION = 20 * 60 * 1000;
let sessionEnd = 0;

onSnapshot(sessionRef, async (snap) => {
  if (!snap.exists()) return;
  const data = snap.data();

  if (data.started && data.startTime) {
    sessionEnd = data.startTime + SESSION_DURATION;

    if (Date.now() < sessionEnd) {
      startBtn.classList.remove('hidden');
    } else {
      lockAll();
    }

    if (data.pairingReady) {
      showPairing();
    }
  }
});

function lockAll() {
  document.querySelectorAll('.card').forEach(c => c.classList.add('hidden'));
  introScreen.classList.remove('hidden');
}

window.next = (n) => {
  document.querySelectorAll('.card').forEach(c => c.classList.add('hidden'));
  document.getElementById('step' + n).classList.remove('hidden');
};

window.finish = async () => {
  await setDoc(doc(responsesRef, crypto.randomUUID()), {
    mainDomain: mainDomain.value,
    secondDomain: secondDomain.value,
    workStyle: workStyle.value,
    teamStyle: teamStyle.value,
    lifeInterest: lifeInterest.value,
    valuePlace: valuePlace.value,
    time: Date.now()
  });
  document.querySelectorAll('.card').forEach(c => c.classList.add('hidden'));
  waiting.classList.remove('hidden');
};

startBtn.onclick = () => {
  introScreen.classList.add('hidden');
  step1.classList.remove('hidden');
};

async function showPairing() {
  const snap = await getDocs(responsesRef);
  let students = snap.docs.map(d => d.data());
  if (students.length < 2) return;

  // פונקציית ניקוד התאמה בין שתיים
  function score(a, b) {
    let s = 0;

    // 1️⃣ תחום עניין – המשקל הגבוה ביותר
    if (a.mainDomain === b.mainDomain) s += 5;
    if (a.mainDomain === b.secondDomain) s += 3;
    if (b.mainDomain === a.secondDomain) s += 3;

    // 2️⃣ סגנון עבודה – השלמה עדיפה על זהות
    if (a.workStyle !== b.workStyle) s += 3;
    if (a.teamStyle !== b.teamStyle) s += 2;

    // 3️⃣ ערכים / חיים – כיוון דומה
    if (a.lifeInterest === b.lifeInterest) s += 1;
    if (a.valuePlace === b.valuePlace) s += 1;

    return s;
  }

  let pairs = [];

  while (students.length > 1) {
    let bestPair = null;
    let bestScore = -1;

    for (let i = 0; i < students.length; i++) {
      for (let j = i + 1; j < students.length; j++) {
        const sc = score(students[i], students[j]);
        if (sc > bestScore) {
          bestScore = sc;
          bestPair = [i, j];
        }
      }
    }

    const [i, j] = bestPair;
    pairs.push([students[i], students[j], bestScore]);

    // הסרה מהמאגר
    students = students.filter((_, idx) => idx !== i && idx !== j);
  }

  // תצוגה
  pairingResult.innerHTML = "";
  pairs.forEach(p => {
    const [a, b, sc] = p;
    const div = document.createElement('div');
    div.className = 'quote';
    div.innerHTML = `
      <strong>${a.mainDomain}</strong><br>
      ${a.lifeInterest}<br><br>
      <strong>השותפה שלך:</strong><br>
      ${b.mainDomain}<br>
      <em>החיבור נבחר לפי תחום משותף והשלמה בסגנון עבודה</em>
    `;
    pairingResult.appendChild(div);
  });

  document.querySelectorAll('.card').forEach(c => c.classList.add('hidden'));
  pairing.classList.remove('hidden');
} · ${pair[1].mainDomain}</p>
  `;

  document.querySelectorAll('.card').forEach(c => c.classList.add('hidden'));
  pairing.classList.remove('hidden');
}
</script>
</body>
</html>
